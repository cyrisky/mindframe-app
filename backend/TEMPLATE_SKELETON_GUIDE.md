# Template Skeleton Guide for Mindframe System

This guide provides a comprehensive template skeleton and instructions for junior developers to create new report templates in the mindframe system.

## Overview

The mindframe system generates PDF reports based on psychological assessment data. Each template type corresponds to a specific assessment and requires:
1. HTML template file
2. CSS styling
3. Data processing logic
4. MongoDB interpretation data

## Template Types Currently Supported

- `kepribadian` - Personality assessment
- `personal_values` - Personal values assessment
- `motivationBoost` - Motivation boost assessment
- `minatBakat` - Interest and talent assessment
- `petaPerilaku` - Behavior mapping assessment

## File Structure

```
backend/
├── simple_api_server.py          # Main server file with template processing
├── templates/                     # HTML template files
│   ├── kepribadian_template.html
│   ├── personal_values_template.html
│   ├── motivation_boost_template.html     # TO BE CREATED
│   ├── minat_bakat_student_template.html  # TO BE CREATED
│   └── peta_perilaku_template.html        # TO BE CREATED
└── generated_results/             # Output folder for generated PDFs
```

## Step 1: Create HTML Template File

### Template Location
Create your template file in: `backend/templates/{template_name}_template.html`

### Basic HTML Template Structure

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report_title }}</title>
    <style>
        /* CSS styles go here */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            padding-bottom: 20px;
        }
        
        .section {
            margin-bottom: 25px;
            page-break-inside: avoid;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            border-left: 4px solid #007bff;
            padding-left: 10px;
        }
        
        .content {
            margin-left: 20px;
        }
        
        .score {
            font-weight: bold;
            color: #007bff;
        }
        
        .interpretation {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        /* Page break utilities */
        .page-break {
            page-break-before: always;
        }
        
        .no-break {
            page-break-inside: avoid;
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <div class="header">
        <h1>{{ report_title }}</h1>
        <p><strong>Name:</strong> {{ user_name }}</p>
        <p><strong>Date:</strong> {{ report_date }}</p>
        <p><strong>Assessment Code:</strong> {{ assessment_code }}</p>
    </div>
    
    <!-- Main Content Sections -->
    {% for section in sections %}
    <div class="section">
        <div class="section-title">{{ section.title }}</div>
        <div class="content">
            {% if section.score %}
            <p><strong>Score:</strong> <span class="score">{{ section.score }}</span></p>
            {% endif %}
            
            {% if section.description %}
            <p>{{ section.description }}</p>
            {% endif %}
            
            {% if section.interpretation %}
            <div class="interpretation">
                <h4>Interpretation:</h4>
                <p>{{ section.interpretation }}</p>
            </div>
            {% endif %}
            
            {% if section.recommendations %}
            <div class="recommendations">
                <h4>Recommendations:</h4>
                <ul>
                {% for recommendation in section.recommendations %}
                    <li>{{ recommendation }}</li>
                {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
    
    <!-- Footer -->
    <div class="footer" style="margin-top: 40px; text-align: center; font-size: 12px; color: #666;">
        <p>Generated by Mindframe System on {{ generation_timestamp }}</p>
    </div>
</body>
</html>
```

## Step 2: Update Server Processing Function

### Add Template Processing Function

In `simple_api_server.py`, add a new processing function after the existing ones:

```python
def process_your_template_name_template(data, code):
    """
    Process [YOUR_TEMPLATE_NAME] template data and generate PDF report.
    
    Args:
        data: Assessment data from request
        code: Assessment code for file naming
    
    Returns:
        dict: Response with success status and file path
    """
    try:
        # 1. Load interpretation data from MongoDB
        interpretation_data = load_interpretation_data_from_mongo('your_test_name')
        if not interpretation_data:
            return {'success': False, 'error': 'No interpretation data found'}
        
        # 2. Extract and validate required data fields
        # Customize these fields based on your assessment data structure
        required_fields = ['field1', 'field2', 'field3']  # Replace with actual fields
        for field in required_fields:
            if field not in data:
                return {'success': False, 'error': f'Missing required field: {field}'}
        
        # 3. Process assessment data
        # Example data processing - customize based on your needs
        processed_sections = []
        
        # Process each assessment dimension/category
        for category, score in data.items():
            if category in interpretation_data:
                section = {
                    'title': interpretation_data[category].get('title', category.title()),
                    'score': score,
                    'description': interpretation_data[category].get('description', ''),
                    'interpretation': get_score_interpretation(score, interpretation_data[category]),
                    'recommendations': interpretation_data[category].get('recommendations', [])
                }
                processed_sections.append(section)
        
        # 4. Prepare template data
        template_data = {
            'report_title': 'Your Assessment Report Title',  # Customize
            'user_name': data.get('user_name', 'Anonymous'),
            'report_date': datetime.now().strftime('%Y-%m-%d'),
            'assessment_code': code,
            'sections': processed_sections,
            'generation_timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        }
        
        # 5. Render HTML template
        template = jinja_env.get_template('your_template_name_template.html')  # Update filename
        html_content = template.render(**template_data)
        
        # 6. Generate PDF
        html_obj = HTML(string=html_content)
        pdf_filename = f'your_template_name_report_{code}_{datetime.now().strftime("%Y%m%d_%H%M%S")}.pdf'
        pdf_path = os.path.join('generated_results', pdf_filename)
        
        # Ensure directory exists
        os.makedirs('generated_results', exist_ok=True)
        
        # Generate PDF
        html_obj.write_pdf(pdf_path)
        
        return {
            'success': True,
            'message': 'Report generated successfully',
            'file_path': pdf_path,
            'filename': pdf_filename
        }
        
    except Exception as e:
        return {'success': False, 'error': f'Error processing template: {str(e)}'}

def get_score_interpretation(score, interpretation_config):
    """
    Get interpretation text based on score and interpretation configuration.
    
    Args:
        score: Numeric score
        interpretation_config: Configuration from MongoDB
    
    Returns:
        str: Interpretation text
    """
    # Example interpretation logic - customize based on your scoring system
    ranges = interpretation_config.get('score_ranges', {})
    
    for range_key, range_config in ranges.items():
        min_score = range_config.get('min', 0)
        max_score = range_config.get('max', 100)
        
        if min_score <= score <= max_score:
            return range_config.get('interpretation', 'No interpretation available')
    
    return 'Score out of defined ranges'
```

### Update Main Generate Report Function

In the `generate_report()` function, add your template case:

```python
# Add this case to the existing if-elif chain
elif template_type == 'your_template_name':
    result = process_your_template_name_template(data, code)
```

## Step 3: MongoDB Interpretation Data Structure

### Required Collection
Ensure your interpretation data exists in:
- Database: `mindframe`
- Collection: `interpretations`
- Document: `{"testName": "your_test_name"}`

### Expected Data Structure

```json
{
  "testName": "your_test_name",
  "category1": {
    "title": "Category 1 Title",
    "description": "Description of what this category measures",
    "score_ranges": {
      "low": {
        "min": 0,
        "max": 33,
        "interpretation": "Low score interpretation text"
      },
      "medium": {
        "min": 34,
        "max": 66,
        "interpretation": "Medium score interpretation text"
      },
      "high": {
        "min": 67,
        "max": 100,
        "interpretation": "High score interpretation text"
      }
    },
    "recommendations": [
      "Recommendation 1 for this category",
      "Recommendation 2 for this category"
    ]
  },
  "category2": {
    // Similar structure for other categories
  }
}
```

## Step 4: Testing Your Template

### Test Data Format
Use this format to test your template via API:

```json
{
  "code": "TEST123",
  "template": "your_template_name",
  "data": {
    "user_name": "Test User",
    "category1": 75,
    "category2": 45,
    "category3": 90
  }
}
```

### API Testing
1. Start the server: `python simple_api_server.py`
2. Send POST request to: `http://localhost:5001/api/generate-report`
3. Check generated PDF in `generated_results/` folder

## Step 5: Customization Guidelines

### Template Variables
Common variables available in templates:
- `{{ report_title }}` - Report title
- `{{ user_name }}` - User's name
- `{{ report_date }}` - Generation date
- `{{ assessment_code }}` - Unique assessment code
- `{{ sections }}` - Array of content sections
- `{{ generation_timestamp }}` - Full timestamp

### CSS Styling Tips
1. Use `page-break-before: always` for new pages
2. Use `page-break-inside: avoid` to keep content together
3. Test with different content lengths
4. Use relative units (em, %) for better scaling
5. Consider print-specific styles

### Data Processing Tips
1. Always validate input data
2. Handle missing interpretation data gracefully
3. Provide default values for optional fields
4. Log errors for debugging
5. Test with various score ranges

## Common Issues and Solutions

### Issue: Template not found
**Solution:** Ensure template file is in `backend/templates/` with correct naming

### Issue: Missing interpretation data
**Solution:** Verify MongoDB connection and document structure

### Issue: PDF generation fails
**Solution:** Check WeasyPrint installation and HTML validity

### Issue: Styling not applied
**Solution:** Ensure CSS is embedded in `<style>` tags within HTML

## Next Steps

1. Create your HTML template file
2. Add processing function to `simple_api_server.py`
3. Update the generate_report function
4. Add interpretation data to MongoDB
5. Test with sample data
6. Refine styling and content

## Support

For additional help:
1. Check existing templates for reference
2. Review MongoDB interpretation data structure
3. Test incrementally with simple data first
4. Use browser developer tools to debug HTML/CSS

Remember: Start simple and iterate. Get basic functionality working before adding complex features.